@import "tailwindcss";

@theme {
  --color-surface: #f2f2f2;
  --color-panel: #ffffff;
  --color-border: #b6b6b6;
  --color-ink: #1f1f1f;
  --color-muted: #4d4d4d;
  --color-accent: #0066cc;
  --color-focus: #003399;
  --color-danger: #cc0000;
  --color-warning: #c97a00;

  --font-sans: "Verdana", "Geneva", "Tahoma", sans-serif;
  --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", monospace;
}

@layer base {
  :root { color-scheme: light; }
  * { @apply box-border; }
  body {
    @apply min-h-screen bg-surface text-ink flex justify-center px-4 pt-8 pb-12 sm:px-6 font-sans;
  }
  .muted { @apply text-muted; }
  header h1 { @apply mb-1 text-lg font-semibold tracking-tight; }
  header p { @apply mb-5 text-muted; }
  form { @apply grid gap-4; }
}

@layer components {
  .shell {
    @apply w-full max-w-[1100px] bg-panel rounded-lg p-5 shadow-none;
  }

  .info {
    @apply border border-border rounded-lg p-4 bg-white grid gap-2 mb-3;
  }

  .info h2 { @apply m-0 text-base font-semibold; }
  .info p { @apply m-0 text-sm text-muted; }
  .info ul { @apply m-0 pl-5 grid gap-1 list-disc; }
  .info li { @apply text-sm text-ink; }

  .columns {
    @apply grid gap-3;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    counter-reset: can;
  }

  .column {
    @apply border border-border rounded-lg p-4 grid gap-2 bg-gradient-to-b from-white/5 to-transparent content-start;
  }

  .column h2 { @apply m-0 text-base font-semibold; }
  .hint { @apply text-muted text-xs m-0; }
  .cells { @apply grid gap-2 content-start; }

  .cell {
    @apply relative flex items-center border border-border rounded-lg bg-white h-14 pl-[42px] pr-3 overflow-hidden;
    counter-increment: can;
  }

  .cell::after {
    content: "";
    position: absolute;
    inset: 6px;
    border-radius: 0.5rem;
    width: var(--fill-pct, 0%);
    max-width: calc(100% - 12px);
    background: var(--fill-color-hsl, transparent);
    background: var(--fill-color-oklch, var(--fill-color-hsl, transparent));
    opacity: 0.28;
    pointer-events: none;
    transition: width 120ms ease, background-color 120ms ease, opacity 120ms ease;
  }

  .cell::before {
    content: "#" counter(can);
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--color-muted);
    font-size: 13px;
    font-weight: 600;
  }

  .cell:has(input:placeholder-shown) { counter-increment: none; }
  .cell:has(input:placeholder-shown)::before { content: ""; }
  .cell label { @apply hidden; }

  .cell input {
    @apply w-full border border-border bg-white text-ink text-sm py-1.5 px-2 rounded-lg outline-none;
  }

  .cell input:focus-visible {
    @apply outline outline-1 outline-focus border-focus;
  }

  .cell[data-fill-state="overflow"],
  .node[data-fill-state="overflow"] {
    @apply border-[var(--color-danger)];
    background: color-mix(in hsl, var(--color-danger) 12%, white);
    background: color-mix(in oklch, var(--color-danger) 12%, white);
  }

  .cell[data-fill-state="overflow"]::before {
    color: var(--color-danger);
  }

  .cell[data-fill-state="underflow"] {
    @apply border-[var(--color-warning)];
    background: color-mix(in hsl, var(--color-warning) 12%, white);
    background: color-mix(in oklch, var(--color-warning) 12%, white);
  }

  .cell[data-fill-state="underflow"]::before {
    color: var(--color-warning);
  }

  button {
    @apply inline-flex items-center justify-start bg-gradient-to-b from-slate-50 to-slate-200 text-slate-900 border border-slate-500 rounded px-3 py-2 font-semibold cursor-pointer shadow-inner transition-colors duration-100;
  }

  button:hover {
    @apply from-slate-100 to-slate-300 border-slate-600;
  }

  button:active {
    @apply bg-slate-300 border-slate-700;
  }

  .output {
    @apply mt-2 bg-white border border-border rounded-lg p-3 min-h-[180px] whitespace-pre-wrap font-mono text-ink;
  }

  .input-errors {
    @apply hidden grid gap-2;
  }

  .input-errors[data-visible="true"] {
    @apply grid;
  }

  .input-errors .error-msg {
    @apply border border-[var(--color-danger)] text-[var(--color-danger)] rounded-lg px-3 py-2 text-sm;
    background: color-mix(in hsl, var(--color-danger) 12%, white);
    background: color-mix(in oklch, var(--color-danger) 12%, white);
  }

  .input-errors .warn-msg {
    @apply border border-[var(--color-warning)] text-[var(--color-warning)] rounded-lg px-3 py-2 text-sm;
    background: color-mix(in hsl, var(--color-warning) 12%, white);
    background: color-mix(in oklch, var(--color-warning) 12%, white);
  }

  .results {
    @apply mt-2;
    display: none;
  }

  .results[data-visible="true"] {
    @apply grid gap-3;
  }

  .graph-panel {
    @apply relative border border-border rounded-lg p-4 bg-slate-50 min-h-[240px] overflow-hidden;
  }

  .graph-grid {
    @apply relative grid gap-3 h-full items-start;
    grid-template-columns: 1fr minmax(160px, 0.8fr) 1fr;
  }

  .graph-headers {
    @apply grid gap-3 mb-1 text-muted font-semibold text-xs px-0.5;
    grid-template-columns: 1fr minmax(160px, 0.8fr) 1fr;
  }

  .node-column { @apply grid gap-2 content-start; }

  .spacer {
    @apply relative;
    min-height: 160px;
  }

  .node {
    @apply border border-border rounded-lg p-2.5 bg-white grid gap-1 relative overflow-hidden;
  }

  .node::after {
    content: "";
    position: absolute;
    inset: 6px;
    border-radius: 0.5rem;
    width: var(--fill-pct, 0%);
    max-width: calc(100% - 12px);
    background: var(--fill-color-hsl, transparent);
    background: var(--fill-color-oklch, var(--fill-color-hsl, transparent));
    opacity: 0.25;
    pointer-events: none;
  }

  .node strong { @apply text-sm; }
  .node .muted { @apply text-muted text-xs; }

  .graph-panel svg { @apply absolute inset-0 pointer-events-none; }
  .edge { @apply stroke-accent/70 stroke-2 fill-none; }
  .edge-label-bg { @apply fill-panel opacity-75; }
  .edge-label { @apply fill-muted text-[12px] font-sans; }

  .status-row {
    @apply mt-2 flex items-center gap-2 text-sm font-mono border border-border rounded-lg px-3 py-2 bg-white;
  }

  .status-icon { @apply text-base w-5 h-5 inline-flex items-center justify-center; }
  /*.status-icon::before { content: "•"; display: block; }*/
  .status-row[data-state="idle"] .status-icon::before { content: "•"; }
  .status-row[data-state="solving"] .status-icon::before {
    content: "⠋";
    animation: spinner-frames 0.9s steps(10) infinite;
  }
  .status-row[data-state="success"] .status-icon::before { content: "✅"; }
  .status-row[data-state="error"] .status-icon::before { content: "⚠️"; }

  .status-row[data-state="idle"] { @apply text-muted; }
  .status-row[data-state="solving"] { color: var(--color-accent); }
  .status-row[data-state="success"] { color: #0f8f3a; }
  .status-row[data-state="error"] { color: var(--color-danger); }
}

@keyframes spinner-frames {
  0% { content: "⠋"; }
  10% { content: "⠙"; }
  20% { content: "⠹"; }
  30% { content: "⠸"; }
  40% { content: "⠼"; }
  50% { content: "⠴"; }
  60% { content: "⠦"; }
  70% { content: "⠧"; }
  80% { content: "⠇"; }
  90% { content: "⠏"; }
  100% { content: "⠋"; }
}
